\section{Architecture Overview}

\subsection{DIRAC Framework}

% refer to CHEP2009, DIRAC3
DIRAC \cite{bib:dirac3} 
has been adopted as the job management system and data management
system for BESIII grid \cite{bib:besdfc}. 
The DIRAC project provides a 
complete set of tools to support the whole LHCb data processing.
It was reorganized to separate generic and LHCb specific functionality
in 2008-2010.
% refer to Ricardo 2012-07 IHEP
%
%DIRAC choose Python as the main programming language.
%The software is well structured. 
It consists of many cooperating distributed services and light-weight
agents which deliver workload to the resources.
Modular design applied in various system components allowed to quickly
introduce new functionality and make component modifications without
affecting other components.
Its secure client/service framework called DISET \cite{bib:diset} 
is full-featured to implement these systems.

\subsection{The BESDIRAC}

% refer to Catriana
Like LHCb, there are BESIII specific functionality in the grid.
The BESDIRAC \cite{bib:besdirac} 
is developed to provide these functionalities.
BADGER (BESIII Advanced Data ManaGER) is the first sub-system
in BESDIRAC. It is implemented based on DIRAC File Catalog(DFC)
and integrated with DIRAC job management.
It provides File Catalog, Metadata Catalog and Dataset Catalog.
%
The transfer system is the second sub-system implemented based on
DIRAC framework. Services and agents are deployed in the server.
The scalability and flexibility of DIRAC framework make the work
easy to be done. 

\subsection{The architecture of the Transfer System}

The transfer system contains:

\begin{itemize}
    \item {\tt Transfer Agent} is the scheduler to manage transfer workers.
    \item {\tt Transfer Request Service} is to manage the transfer requests
          created by users.
    \item {\tt Transfer DB} is the shared memory between the agent and 
          service. 
    \item {\tt Dataset Service} is for dataset management which is 
          {\em deprecated} because it is in DFC now.
    \item {\tt Accounting} is to keep the transfer history.
          It follows the structure in DIRAC Accounting System
          \cite{bib:diracacct}.
          It can be shown in the web portal.
    \item {\tt Web Portal} and {\tt command line scripts} are the 
          User Interface for users.
\end{itemize}

The workflow is shown in Figure \ref{fig:workflow} and described as follows.
\begin{figure}[htbp]
    %\centering
    \input{sub_workflow.tex}
    \caption{Workflow of transfer system} \label{fig:workflow}
\end{figure}

\begin{enumerate}
\item User create a dataset in DFC first.
\item User create the transfer request
whose information will be saved in the transfer DB via
the transfer request service.
\item Transfer agent will transfer these files in DB.
\end{enumerate}

