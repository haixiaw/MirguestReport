\section{Architecture Overview}

\subsection{DIRAC Framework}

% refer to CHEP2009, DIRAC3
DIRAC \cite{bib:dirac3} 
has been adopted as the job management system and data management
system for BESIII grid \cite{bib:besdfc}. 
The DIRAC project provides a 
complete set of tools to support the whole LHCb data processing.
It was reorganized to separate generic and LHCb specific functionality
in 2008-2010.
% refer to Ricardo 2012-07 IHEP

DIRAC choose Python as the main programming language.
The software is well structured. 
It consists of many cooperating distributed services and light-weight
agents which deliver workload to the resources.
Modular design applied in various system components allowed to quickly
introduce new functionality and make component modifications without
affecting other components.
Its secure client/service framework called DISET \cite{bib:diset} 
is full-featured to implement these systems.

\subsection{The BESDIRAC}

% refer to Catriana
Like LHCb, there are BESIII specific functionalities in the grid.
The BESDIRAC \cite{bib:besdirac} 
is developed to provide these functionalities.
BADGER, the BESIII Advanced Data ManaGER, is the first sub-system
in BESDIRAC. It is implemented based on DIRAC File Catalog(DFC)
and integrated with DIRAC job management.
It provides File Catalog, Metadata Catalog and Dataset Catalog.

The transfer system is the second sub-system implemented based on
DIRAC framework. We create services and agents in the server side.
The scalability and flexibility of DIRAC framework make the work
easy to be done. 

\subsection{The architecture of the Transfer System}

The transfer system contains:

\begin{itemize}
    \item {\tt Transfer Agent} is the scheduler to create transfer worker.
          The transfer worker create a process to do the transfer work.
    \item {\tt Transfer Request Service} is to manage the transfer requests
          created by users.
    \item {\tt Transfer DB} is the shared memory between the agent and 
          service. It keeps the users' requests and files to be transferred.
    \item {\tt Dataset Service} is for dataset management. It is 
          {\em deprecated}. The dataset management will be supported in DIRAC
          File Catalog.
    \item {\tt Accounting} is to keep the transfer history.
          It follows the structure in DIRAC Accounting System
          \cite{bib:diracacct}.
          We can plot the history in the web portal.
    \item {\tt Web Portal} and {\tt command line scripts} are the 
          User Interface for user and manager.
\end{itemize}

The workflow is shown in Figure \ref{fig:workflow} and described as follows.
\begin{figure}
    %\centering
    \input{sub_workflow.tex}
    \caption{Workflow of transfer system} \label{fig:workflow}
\end{figure}

\begin{enumerate}
\item The user create a dataset in DFC first.
\item Then, user create the transfer request.
The information of the request will be saved in the transfer DB via
the transfer request service.
\item The transfer agent will transfer these files.
\end{enumerate}

In the client side, both command line scripts and web portal are supported.
The web portal 
\cite{bib:webportal}
is using JavaScript to provide an interactive interface. The functionalities
include transfer requests management, dataset management and the 
accounting.

In the server side, the services and agents are controlled by runit.
The web portal uses Pylons as the web framework
\cite{bib:webportal}.
The Pylons redirect the HTTP requests to the DIRAC services and 
return the results to the users.
