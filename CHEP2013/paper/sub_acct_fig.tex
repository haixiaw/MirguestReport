\begin{center}
\tikzstyle{block} = [rectangle, draw, fill=blue!20, text width=5em, text centered, rounded corners]
\tikzstyle{line} = [draw, -latex, line width=.1em]

\pgfdeclarelayer{background}
\pgfdeclarelayer{foreground}
\pgfsetlayers{background,main,foreground}

\begin{tikzpicture}[node distance = 2cm, auto]

    % DIRAC Accounting System
    \node [block] (acctkernel) {DIRAC Accounting System};
    % Web Portal
    \node [block, left of=acctkernel, node distance=2.6cm
            ] (webportal) {Web Portal};

    % vertical line
    \node [right of=acctkernel, node distance=2.0cm,
            yshift=0.5cm](v1){};
    \node [right of=acctkernel, node distance=2.0cm,
            yshift=-0.5cm](v2){};

    % user defined type
    \node [block, right of=v1, node distance=1cm, text width=6em,
            ] (usertype) {User Defined Type};
    % type plotter
    \node [block, right of=v2, node distance=1cm, text width=6em,
            ] (plotter) {Type Plotter};

    % key/value fields
    \node [right of=usertype, node distance=2cm,
            yshift=0.3cm](kfv){};
    \node [right of=usertype, node distance=2cm,
            yshift=-0.3cm](vfv){};
    \node [right of=kfv, node distance=1cm,
            ](kf){Key Fields};
    \node [right of=vfv, node distance=1cm,
            ](vf){Value Fields};

    \node [rectangle, draw, right of=kf, node distance=3.3cm,
            text width=4cm
            ] (vkf){{\tt\footnotesize user,src,dest,protocol...}};
    \node [rectangle, draw, right of=vf, node distance=3.3cm,
            text width=4cm
            ] (vvf){{\tt\footnotesize size,time,OK}};

    % plot/report 
    \node [right of=plotter, node distance=2cm,
            yshift=0.3cm](ppv){};
    \node [right of=plotter, node distance=2cm,
            yshift=-0.3cm](prv){};
    \node [right of=ppv, node distance=1cm,
            ](pp){\verb"_plotXXX"};
    \node [right of=prv, node distance=1cm,
            ](pr){\verb"_reportXXX"};

    % Path
    \path[line,<->](usertype)--(acctkernel);
    \path[line,<->](plotter)--(acctkernel);
    \path[line,<->](webportal)--(acctkernel);

    % curly braces
    \draw[decorate,decoration={brace,mirror}
            ](kfv.north west)--(vfv.south west);
    \draw[decorate,decoration={brace,mirror}
            ](ppv.north west)--(prv.south west);

    % background
    \begin{pgfonlayer}{background}
        \path (usertype.north west)+(-0.25,0.25) node (g) {};
        \path (plotter.south east)+(0.25,-0.25) node (h) {};
        \path[fill=yellow!20,rounded corners,
        draw=black!50, dashed]
        (g) rectangle (h);
    \end{pgfonlayer}

\end{tikzpicture}
\end{center}

